# CFSpider 学习系统说明

## 系统架构

CFSpider 拥有像真人一样的学习和记忆系统，可以不断进化和提升。

```
用户操作请求
    ↓
技能匹配（是否已学会）
    ↓
执行操作
    ↓
记录结果（成功/失败）
    ↓
学习记忆系统 ←→ 技能系统
    ↓
永久保存到磁盘
```

## 学习记忆系统

### 记忆类型
- **成功经验**: 记录成功的操作方法
- **失败教训**: 记录失败的操作，避免重复
- **操作技巧**: 从多次操作中总结的技巧

### 记忆强度
- **100-80**: 非常清晰，随时能想起来
- **80-60**: 清晰记忆，经常使用
- **60-30**: 偶尔想不起来
- **30-10**: 很难想起来，需要提示
- **10-5**: 快忘了，但还有一点印象
- **< 5**: 几乎忘了，但永远不会真正删除

### 遗忘曲线
- 每天自动衰减 3-8 点强度（随机）
- 情绪化记忆（失败教训）衰减速度减半
- 经常使用的记忆衰减更慢
- 强度很低的记忆有 5% 概率突然想起来

### 记忆强化
- 每次成功使用 +5 点强度
- 克服困难（从失败到成功）+15 点
- 情绪化事件（特别成功或失败）标记为难忘
- 突然想起来 +30 点（印象更深）

### 永久保存
- 所有记忆永久保存，无容量限制
- 文件位置: `%APPDATA%/cfspider-browser/learning-memory.json`
- 30% 概率渐进保存（每次 1-3 条）
- 强度很低的记忆也保留（可能被唤醒）

## 技能系统

### 技能来源

1. **内置技能**
   - 预定义的常见操作流程
   - 由开发者编写，经过优化
   - 示例: 必应搜索、点击搜索结果

2. **学习技能**
   - 从实际操作中自动生成
   - 条件: 成功 3 次 + 强度 >= 70
   - 自动提取触发词和步骤

### 技能升级条件

```
学习记忆
  - 类型: success
  - 回忆次数: >= 3
  - 记忆强度: >= 70
    ↓
自动提升为技能
    ↓
技能生成
  - ID: user-{timestamp}-{random}
  - 名称: {domain}-{action}-{target}
  - 触发词: 从记忆中提取
  - 步骤: 从成功操作中总结
  - 初始成功率: 60 + (回忆次数 × 5)
    ↓
永久保存到 skills.json
```

### 技能进化

```
第1-5次使用
  - 使用预定义步骤
  - 成功率基于初始值
    ↓
第5-20次使用
  - 从每次操作中提取模式
  - 学习最佳选择器
  - 优化备选方案
  - 成功率持续调整
    ↓
第20次以上
  - 成功率稳定
  - 拥有多个学习模式
  - 选择器库丰富
  - 成为"专家级"技能
```

### 技能优化

- **模式提取**: 记录成功的选择器和流程
- **备选方案**: 失败时的备选方案加入技能
- **成功率**: 移动平均（最近 20 次）
- **优先级**: 高成功率 + 高使用次数 = 优先匹配

### 永久保存
- 所有学会的技能永久保存
- 文件位置: `%APPDATA%/cfspider-browser/skills.json`
- 内置技能的学习数据也会保存
- 不删除任何技能（除非用户手动删除）

## 智能纠错系统

### 短期错误记录（30分钟）
- 记录本次会话的点击失败
- 30 分钟后自动过期
- 用于避免重复尝试同一错误

### 长期学习记忆（永久）
- 记录深刻的失败教训
- 永久保存，但强度会衰减
- 失败 2 次以上会强烈警告

### 纠错流程

```
第1次失败
  ↓
记录到短期错误（30分钟）
  ↓
第2次尝试同样操作
  ↓
警告：已失败1次
  ↓
第2次也失败
  ↓
创建长期记忆（永久）
  - 类型: error
  - 强度: 60（教训深刻）
  - 情绪化: true
    ↓
第3次尝试
  ↓
强烈警告并建议备选方案
```

## 使用示例

### 示例 1: 学会打开 GitHub

```
Day 1 - 第1次
用户: "打开 GitHub"
  -> 搜索 GitHub
  -> 点击第1个结果
  -> 成功到达 github.com
  -> 创建记忆（强度 40）

Day 2 - 第2次
用户: "打开 GitHub"
  -> 回忆起来："我记得怎么做"
  -> 重复操作
  -> 成功
  -> 强化记忆（强度 55）

Day 3 - 第3次
用户: "打开 GitHub"
  -> 清晰记忆
  -> 执行操作
  -> 成功
  -> 强化记忆（强度 70）
  -> 自动提升为技能！

Day 4+
用户: "打开 GitHub"
  -> 匹配到技能 "打开 GitHub"
  -> AI 看到技能提示
  -> 按照技能流程执行
  -> 更快更准确
  -> 技能成功率持续提升
```

### 示例 2: 遗忘和回忆

```
Day 1: 学会操作 A（强度 70）
Day 10: 没用过（强度 40，衰减）
Day 20: 没用过（强度 15，几乎忘了）
Day 21: 
  用户要求操作 A
  -> 想不起来了："我靠，我忘记了..."
  -> 只有模糊记忆："好像是点那个按钮..."
  -> 5% 概率突然想起来！
  -> "诶？我突然想起来了！"
  -> 强度恢复到 45
  -> 操作成功
  -> 强度变为 50
```

## 技能文件格式

### Markdown 格式（易读易编辑）

技能文档位于 `src/services/skills/` 目录：
- `bing-search.md`
- `click-search-result.md`
- `navigate-to-website.md`
- `iqiyi-navigation.md`

### 代码格式（可执行）

技能数据位于 `src/services/builtinSkills.ts`，从 Markdown 解析而来。

## 数据文件

所有数据永久保存在用户目录：

```
%APPDATA%/cfspider-browser/
├── learning-memory.json    # 学习记忆（无限制）
├── skills.json             # 技能数据（无限制）
├── ai-config.json          # AI 配置
├── chat-sessions.json      # 聊天历史
├── history.json            # 浏览历史
├── rules.json              # 爬取规则
└── browser-settings.json   # 浏览器设置
```

## 统计数据

系统会追踪：
- 每个技能的使用次数
- 成功率（移动平均）
- 学习到的模式数量
- 记忆强度分布
- 最常用的操作

## 未来展望

随着使用时间增长：
- 技能库会越来越丰富
- 每个网站都会有专门的操作技能
- 失败的操作会被永久避免
- 成功率会持续提升
- 真正做到"越用越聪明"
