# CFSpider 更新日志

## 2026-01-29 重大更新

### 核心改进

#### 1. 元素定位修复
- 修复 `scan_interactive_elements` 返回唯一选择器和精确坐标
- 新增 `click_by_index` 工具，使用缓存坐标精确点击
- 添加点击前验证，过滤翻页按钮、导航元素
- 扫描结果缓存 30 秒，支持链接数量增加到 20 个

#### 2. 智能学习记忆系统
- 永久保存所有学习记忆（无容量限制）
- 记忆强度会衰减但永不删除
- 5% 概率突然想起沉睡的记忆
- 30% 概率渐进保存（模拟真人学习）
- 成功 3 次 + 强度 >= 70 自动提升为技能

#### 3. 技能系统（Skills）
- 创建独立的技能系统框架
- 6 个预置技能（必应搜索、点击搜索结果、访问网站等）
- 技能会随使用自动学习和优化
- 从成功操作中提取最佳选择器
- 技能永久保存，越用越熟练

#### 4. 智能登录系统
- 自动检测登录页面和表单
- 询问用户选择：自动登录 or 手动登录
- 自动登录：模拟真人操作（移动鼠标、点击、输入）
- 凭证加密存储在本地
- 从用户消息中智能提取账号密码

#### 5. 自动关闭弹窗
- 每 2 秒自动检测并关闭广告弹窗
- 支持版本提示、会员升级、隐私政策等
- 智能识别登录框，不会误关闭
- 新增 `close_popup` 手动关闭工具

#### 6. 思考行为优化
- 思考时鼠标持续移动（停顿 50-150ms）
- 像真人一样在屏幕上漫无目的地移动
- 操作完成后自动恢复思考模式
- 失败时触发 panic 模式，然后继续思考

#### 7. 智能纠错增强
- 短期错误记录（30分钟过期）
- 长期学习记忆（永久保存）
- 错误不会再犯（记录失败元素）
- 失败 2 次强烈警告并建议备选方案

#### 8. 搜索引擎优化
- 切换到国内版必应（cn.bing.com）
- 无 Copilot 广告干扰
- 三重 Copilot 过滤（候选生成、过滤、最终验证）
- 修复主域名评分（支持无 www 前缀）
- 过滤图片搜索、山寨网站

#### 9. AI 服务预设扩展
- 新增 GitHub Models（使用 GitHub PAT）
- 新增 NVIDIA NIM（支持 Kimi-K2.5、DeepSeek-V3.2）
- AI 请求超时增加到 180 秒
- User-Agent 更新到 Edge 144（真实版本）

### 数据文件

所有数据永久保存在：`%APPDATA%/cfspider-browser/`

| 文件 | 说明 | 容量限制 |
|------|------|---------|
| `learning-memory.json` | 学习记忆 | 无限制（永久保存） |
| `skills.json` | 技能数据 | 无限制（永久保存） |
| `credentials.json` | 登录凭证 | 无限制（加密存储） |
| `ai-config.json` | AI 配置 | - |
| `chat-sessions.json` | 聊天历史 | - |
| `history.json` | 浏览历史 | - |
| `rules.json` | 爬取规则 | - |

### 技能文档

位于 `src/services/skills/`：
- `README.md` - 技能系统说明
- `bing-search.md` - 必应搜索
- `click-search-result.md` - 点击搜索结果
- `navigate-to-website.md` - 访问网站
- `iqiyi-navigation.md` - 爱奇艺导航
- `auto-login.md` - 智能登录

### 新增工具

| 工具 | 说明 | 用途 |
|------|------|------|
| `click_by_index` | 精确索引点击 | 配合 scan 使用，不会点错 |
| `close_popup` | 关闭弹窗 | 手动关闭顽固弹窗 |
| `detect_login` | 检测登录 | 识别登录页面和表单 |
| `request_login_choice` | 询问登录方式 | 让用户选择自动/手动 |
| `auto_login` | 自动登录 | 智能填写并提交表单 |

### 使用流程改进

**之前（容易点错）**：
```
用户: "打开爱奇艺"
AI: 搜索 -> click_text("爱奇艺") -> 误点到翻页
```

**现在（精确定位）**：
```
用户: "打开爱奇艺"
AI: 搜索 -> scan_interactive_elements()
     -> 看到 "3. 爱奇艺官网 -> iqiyi.com"
     -> click_by_index(type="link", index=3)
     -> 精确点击第3个链接
     -> 成功！学习这个经验
     -> 3次后自动形成"打开爱奇艺"技能
```

### 学习成长示例

```
Day 1: 第1次打开 GitHub
  -> 创建记忆（强度 40）

Day 2: 第2次打开 GitHub
  -> 强化记忆（强度 55）
  -> AI："这个我有印象~"

Day 3: 第3次打开 GitHub
  -> 强化记忆（强度 70）
  -> 自动提升为技能！

Day 4+: 使用技能
  -> 匹配到"打开 GitHub"技能
  -> AI 看到技能提示
  -> 按最优流程执行
  -> 更快更准确

Day 30: 很久没用了
  -> 记忆强度降低到 15
  -> AI："我靠，我忘记了..."
  -> 5% 概率突然想起来："诶？我突然想起来了！"
```

### 破坏性变更
- 无

### 兼容性
- Electron 28+
- Windows 10+
- Node.js 18+

### 下一步计划
- 更多网站特定技能（京东、淘宝、B站等）
- 验证码智能处理
- 表单智能填写
- 购物流程自动化
